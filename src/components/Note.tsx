import { useEffect, useRef, useState } from "react";

const icons = {
    blanche: "M7.6,18.66c0-1.29,.01-2.51,.02-3.74,0-1.23,0-2.46,0-3.69v-3.84c0-1.23,0-2.46,0-3.69,0-1.22-.03-2.44,.03-3.71h1.04c.04,.3,.11,.58,.11,.87-.03,6.59-.12,13.19-.09,19.78,.02,3.73-3.71,5.61-6.54,5.03-1.65-.34-2.53-1.85-2.05-3.46,.22-.73,.6-1.35,1.14-1.87,1.55-1.47,3.34-2.21,5.51-1.79,.23,.04,.47,.06,.81,.1Zm-4.44,5.78c.95-.01,2.07-.41,2.87-.99,.61-.44,1.11-.97,1.39-1.69,.28-.71,.05-1.43-.64-1.73-.39-.17-.86-.27-1.28-.23-1.49,.14-2.73,.79-3.64,2.01-.39,.53-.68,1.14-.35,1.79,.36,.7,1.07,.8,1.65,.84Z",
    clef: "M10,10 L20,10 L20,20 L10,20 Z",
    double: "M1187 -9.6757e-05C1187.02 89.2707 1187.03 178.541 1187.04 267.812C1187.04 269.146 1187.04 270.481 1187.04 271.815C1187.05 299.819 1187.05 327.824 1187.05 355.828C1187.05 369.896 1187.05 383.963 1187.05 398.031C1187.05 400.153 1187.06 402.275 1187.06 404.397C1187.06 437.073 1187.06 469.748 1187.07 502.423C1187.07 503.126 1187.07 503.828 1187.07 504.552C1187.07 515.879 1187.07 527.206 1187.08 538.532C1187.08 571.158 1187.09 603.783 1187.09 636.408C1187.09 637.079 1187.09 637.75 1187.09 638.441C1187.09 652.509 1187.09 666.577 1187.09 680.645C1187.09 687.233 1187.09 693.821 1187.09 700.409C1187.09 701.706 1187.1 703.003 1187.1 704.339C1187.1 725.228 1187.1 746.117 1187.11 767.007C1187.11 787.997 1187.11 808.988 1187.11 829.979C1187.11 842.456 1187.11 854.934 1187.12 867.411C1187.12 875.742 1187.12 884.073 1187.12 892.404C1187.12 897.154 1187.12 901.903 1187.12 906.653C1187.13 910.975 1187.13 915.297 1187.12 919.62C1187.12 921.172 1187.12 922.724 1187.13 924.277C1187.14 932.567 1186.96 940.756 1186 949C1186.33 949 1186.66 949 1187 949C1186.6 956.216 1185.88 963.294 1183 970C1182.34 970.33 1181.68 970.66 1181 971C1181 972.98 1181 974.96 1181 977C1180.34 977 1179.68 977 1179 977C1178.88 978.093 1178.75 979.186 1178.62 980.312C1178 984 1178 984 1176 987C1174.89 988.949 1174.89 988.949 1174.7 991.109C1173.71 995.181 1171.8 998.581 1169.81 1002.25C1169.41 1003 1169 1003.76 1168.59 1004.53C1160.64 1019.18 1160.64 1019.18 1157 1021C1156.54 1022.21 1156.54 1022.21 1156.06 1023.44C1155 1026 1155 1026 1152 1028C1151.67 1028.99 1151.34 1029.98 1151 1031C1150.34 1031.33 1149.68 1031.66 1149 1032C1148.71 1032.64 1148.42 1033.28 1148.12 1033.94C1147 1036 1147 1036 1144.94 1037C1144.3 1037.33 1143.66 1037.66 1143 1038C1142.86 1038.64 1142.71 1039.28 1142.56 1039.94C1142.38 1040.62 1142.19 1041.3 1142 1042C1141.33 1042.37 1140.67 1042.74 1139.98 1043.13C1135.66 1045.84 1132.33 1049.39 1128.75 1053C1128.02 1053.72 1127.29 1054.45 1126.53 1055.2C1125.49 1056.24 1125.49 1056.24 1124.42 1057.31C1123.79 1057.95 1123.16 1058.58 1122.5 1059.24C1120.78 1061.03 1120.78 1061.03 1120 1064C1118.68 1064.37 1117.34 1064.7 1116 1065C1114.07 1066.28 1114.07 1066.28 1112.31 1067.87C1111.71 1068.39 1111.11 1068.9 1110.49 1069.43C1108.75 1071.04 1108.75 1071.04 1108 1074C1106.68 1074.37 1105.34 1074.7 1104 1075C1100.32 1077.1 1096.83 1079.51 1093.31 1081.87C1092.34 1082.51 1091.36 1083.15 1090.36 1083.81C1089.43 1084.43 1088.51 1085.04 1087.55 1085.68C1086.7 1086.24 1085.85 1086.81 1084.98 1087.39C1082.73 1088.93 1082.73 1088.93 1082 1092C1081.17 1092.07 1080.35 1092.15 1079.5 1092.22C1075.1 1093.2 1071.9 1095.15 1068.06 1097.44C1034.46 1116.68 996.216 1127.13 958 1132C957.345 1132.09 956.69 1132.17 956.015 1132.26C950.119 1132.99 944.288 1133.19 938.352 1133.24C937.349 1133.25 936.347 1133.26 935.314 1133.27C914.218 1133.43 893.712 1133.49 873 1129C872.081 1128.81 871.161 1128.63 870.214 1128.43C841.064 1122.45 814.005 1111.43 789.686 1094.18C786.543 1091.98 783.637 1090.21 780 1089C779.719 1088.42 779.438 1087.85 779.148 1087.26C777.544 1084.1 775.249 1082.23 772.625 1079.87C771.669 1079.01 770.712 1078.14 769.727 1077.24C767.469 1075.39 765.572 1074.28 763 1073C762.691 1072.2 762.381 1071.39 762.062 1070.56C760.704 1067.29 759.021 1066.7 756 1065C755.67 1064.01 755.34 1063.02 755 1062C754.34 1061.34 753.68 1060.68 753 1060C751 1058 751 1058 750 1055C748.122 1052.06 748.122 1052.06 746.137 1049.8C743.571 1046.44 741.703 1042.96 739.812 1039.19C739.457 1038.51 739.102 1037.84 738.736 1037.15C736.33 1032.37 735.4 1028.33 735 1023C734.34 1023 733.68 1023 733 1023C732.963 1022.46 732.925 1021.93 732.887 1021.37C732.424 1015.86 731.566 1010.49 730.5 1005.06C727.696 990.594 727.378 976.705 729.288 962.109C729.893 957.381 730.068 952.848 729.938 948.094C730.035 944.829 730.931 942.073 732 939C732.66 939 733.32 939 734 939C735.778 934.031 735.778 934.031 735 929C735.922 926.635 736.917 924.296 738 922C738.66 922 739.32 922 740 922C740.085 921.005 740.17 920.01 740.258 918.984C740.892 914.565 742.717 911.11 744.875 907.25C745.227 906.591 745.579 905.932 745.941 905.254C747.669 902.088 749.345 899.442 752 897C752.144 896.361 752.289 895.721 752.438 895.062C753.211 892.225 754.883 890.988 757 889C758.961 886.218 758.961 886.218 760 883.875C761 882 761 882 763 881C763.33 880.01 763.66 879.02 764 878C764.66 877.67 765.32 877.34 766 877C766.33 876.34 766.66 875.68 767 875C768 873 768 873 770 872C770.268 871.381 770.536 870.762 770.812 870.125C772 868 772 868 774.315 866.621C777.057 864.965 778.942 863.244 781.152 860.937C781.922 860.146 782.691 859.354 783.483 858.539C784.293 857.701 785.103 856.863 785.938 856C793.011 848.81 800.143 842.198 808.288 836.255C810.098 834.928 811.883 833.572 813.668 832.211C872.749 787.5 950.585 768.839 1023.68 776.756C1026.97 777.102 1030.26 777.37 1033.56 777.625C1034.51 777.7 1035.46 777.774 1036.44 777.851C1038.96 777.997 1041.48 778 1044 778C1044 611.35 1044 444.7 1044 273C1036.95 272.876 1036.95 272.876 1030.31 273.743C1029.5 273.908 1028.69 274.074 1027.85 274.244C1026.99 274.428 1026.13 274.611 1025.25 274.801C1023.85 275.089 1023.85 275.089 1022.43 275.382C1019.35 276.017 1016.28 276.665 1013.21 277.312C1011.04 277.765 1008.86 278.217 1006.68 278.667C1000.93 279.86 995.179 281.063 989.43 282.268C983.733 283.462 978.033 284.647 972.334 285.832C971.222 286.063 970.111 286.294 968.966 286.532C966.729 286.997 964.492 287.462 962.256 287.927C958.885 288.628 955.515 289.331 952.145 290.033C937.563 293.068 922.969 296.033 908.36 298.937C894.43 301.707 880.509 304.525 866.59 307.355C865.439 307.589 864.288 307.823 863.103 308.065C855.947 309.52 848.791 310.977 841.635 312.434C837.882 313.199 834.129 313.963 830.376 314.727C800.826 320.742 771.28 326.775 741.75 332.888C721.514 337.077 701.267 341.208 681.014 345.313C677.637 345.997 674.26 346.682 670.883 347.367C670.192 347.507 669.501 347.647 668.789 347.792C656.271 350.331 643.756 352.886 631.242 355.445C629.819 355.736 629.819 355.736 628.367 356.033C623.478 357.033 618.589 358.033 613.699 359.033C580.077 365.91 546.45 372.759 512.812 379.562C511.904 379.746 510.995 379.93 510.059 380.119C504.067 381.331 498.074 382.543 492.082 383.754C491.324 383.907 490.565 384.06 489.784 384.218C481.857 385.82 473.93 387.419 466 389C466 389.66 466 390.32 466 391C465.34 391 464.68 391 464 391C464 391.6 464 392.201 464 392.819C464.017 458.168 464.033 523.517 464.042 588.867C464.042 589.842 464.043 590.818 464.043 591.824C464.046 613.03 464.049 634.237 464.051 655.444C464.052 665.843 464.054 676.243 464.055 686.642C464.055 687.677 464.055 688.712 464.055 689.778C464.06 723.334 464.067 756.89 464.076 790.445C464.086 824.923 464.092 859.4 464.094 893.877C464.094 898.744 464.095 903.611 464.095 908.479C464.095 909.437 464.095 910.395 464.095 911.382C464.096 926.815 464.101 942.249 464.107 957.683C464.113 973.191 464.115 988.699 464.114 1004.21C464.113 1013.43 464.115 1022.65 464.121 1031.86C464.125 1038.02 464.125 1044.17 464.122 1050.33C464.12 1053.84 464.12 1057.35 464.125 1060.86C464.129 1064.63 464.127 1068.41 464.123 1072.19C464.126 1073.28 464.128 1074.37 464.131 1075.5C464.119 1081.09 463.836 1086.46 463 1092C462.67 1092 462.34 1092 462 1092C462 1088.7 462 1085.4 462 1082C460.282 1094.99 460.282 1094.99 460.125 1108.05C459.972 1110.44 459.147 1111.92 458 1114C456.916 1116.96 456.916 1116.96 456.562 1120C455.866 1123.71 454.083 1125.88 452 1129C451.833 1131.63 451.833 1131.63 452 1134C451.34 1134 450.68 1134 450 1134C450.088 1134.65 450.175 1135.3 450.266 1135.97C449.879 1140.38 447.873 1143.61 445.75 1147.44C445.156 1148.54 445.156 1148.54 444.551 1149.67C442.241 1153.93 439.889 1158.11 437 1162C436.34 1162 435.68 1162 435 1162C434.752 1162.87 434.505 1163.73 434.25 1164.62C432.748 1168.68 431.022 1172.99 427 1175C426.67 1175.66 426.34 1176.32 426 1177C425 1179 425 1179 423 1180C422.67 1180.99 422.34 1181.98 422 1183C421.01 1183.46 421.01 1183.46 420 1183.94C419.01 1184.46 419.01 1184.46 418 1185C417.856 1185.64 417.711 1186.28 417.562 1186.94C416.73 1189.99 414.67 1190.42 412 1192C410.625 1193.23 409.293 1194.51 408.004 1195.84C407.28 1196.57 406.556 1197.31 405.811 1198.06C404.698 1199.21 404.698 1199.21 403.562 1200.37C395.242 1208.89 395.242 1208.89 391.527 1211.85C388.773 1213.82 388.773 1213.82 388 1217C385.938 1217.69 385.938 1217.69 384 1218C384 1218.66 384 1219.32 384 1220C383.466 1220.07 382.933 1220.15 382.383 1220.23C379.081 1221.3 376.614 1223.31 373.875 1225.37C324.779 1261.24 263.832 1280.44 203.191 1280.32C199.901 1280.31 196.611 1280.34 193.32 1280.36C174.797 1280.42 156.505 1278.87 138.5 1274.31C137.475 1274.06 136.45 1273.8 135.394 1273.54C106.873 1266.23 80.5715 1254.56 57.6719 1235.93C55.225 1233.9 55.225 1233.9 52.7656 1233.47C52.183 1233.32 51.6003 1233.16 51 1233C50.3065 1231.68 49.6467 1230.34 49 1229C47.0802 1226.89 45.153 1224.87 43.125 1222.87C42.3303 1222.07 42.3303 1222.07 41.5195 1221.25C38.8219 1218.56 36.3961 1216.66 33 1215C32.67 1214.01 32.34 1213.02 32 1212C31.01 1211.34 30.02 1210.68 29 1210C28.7834 1208.76 28.7834 1208.76 28.5625 1207.5C28.2841 1206.26 28.2841 1206.26 28 1205C26.6753 1204.32 25.3414 1203.65 24 1203C22.8125 1200.5 22.8125 1200.5 22 1198C21.1372 1195.97 21.1372 1195.97 19.625 1194.75C17.0093 1191.93 15.3797 1188.61 14.5 1184.87C14.0961 1182.85 14.0961 1182.85 12.4375 1181.06C10.6736 1178.53 10.7484 1177.02 11 1174C10.34 1174 9.68 1174 9 1174C8.87625 1172.89 8.7525 1171.77 8.625 1170.62C8.35342 1166.97 8.35342 1166.97 6 1165C6 1163.12 6.00737 1161.25 6.0625 1159.37C5.95155 1155.16 4.94052 1151.1 4 1147C3.34 1147 2.68 1147 2 1147C0.250652 1133.88 0.250652 1120.12 2 1107C2.66 1107 3.32 1107 4 1107C4.5316 1104.59 5.05054 1102.17 5.5625 1099.75C5.78969 1098.73 5.78969 1098.73 6.02148 1097.68C6.77883 1094.06 6.96696 1091.54 6 1088C6.66 1087.01 7.32 1086.02 8 1085C8.82493 1082.53 9.37346 1080.23 9.875 1077.69C10.7314 1073.77 11.9201 1070.47 14 1067C14.66 1066.67 15.32 1066.34 16 1066C16.1953 1064.71 16.1953 1064.71 16.3945 1063.39C17.1118 1059.37 18.7284 1056.21 20.6875 1052.69C21.0447 1052.03 21.402 1051.38 21.77 1050.7C29.4642 1036.77 29.4642 1036.77 33 1035C33.6709 1033.66 34.3167 1032.3 34.9375 1030.94C36 1029 36 1029 38 1028C38.33 1027.01 38.66 1026.02 39 1025C39.66 1024.67 40.32 1024.34 41 1024C41.3094 1023.34 41.6187 1022.68 41.9375 1022C43 1020 43 1020 46 1019C46.1856 1018.07 46.1856 1018.07 46.375 1017.12C47.2839 1014.03 49.2724 1013.62 52 1012C53.4938 1010.68 54.945 1009.32 56.3555 1007.91C57.5359 1006.73 57.5359 1006.73 58.7402 1005.53C59.9516 1004.31 59.9516 1004.31 61.1875 1003.06C62.0067 1002.25 62.8259 1001.44 63.6699 1000.6C64.453 999.818 65.2361 999.032 66.043 998.223C66.7548 997.508 67.4666 996.794 68.2 996.059C70.077 994.112 70.077 994.112 70.9973 991.798C72 990 72 990 73.9011 989.412C74.9401 989.208 74.9401 989.208 76 989C77.8245 987.863 77.8245 987.863 79.582 986.41C80.2584 985.878 80.9347 985.346 81.6316 984.798C82.7111 983.939 82.7111 983.939 83.8125 983.062C141.177 938.47 215.832 917.216 288.125 922.812C289.03 922.882 289.935 922.952 290.867 923.024C300.363 923.866 309.516 925.502 319 927C319 679.17 319 431.34 319 176C327.033 174.146 335.04 172.331 343.115 170.701C344.143 170.492 345.17 170.283 346.228 170.068C349.59 169.385 352.953 168.704 356.316 168.023C358.715 167.536 361.114 167.049 363.513 166.562C368.512 165.547 373.512 164.532 378.511 163.519C385.669 162.067 392.827 160.613 399.984 159.157C401.123 158.926 402.261 158.694 403.434 158.455C405.732 157.988 408.029 157.521 410.327 157.053C414.958 156.111 419.589 155.17 424.221 154.228C480.751 142.736 480.751 142.736 537.254 131.111C557.489 126.922 577.734 122.792 597.986 118.687C601.363 118.002 604.74 117.318 608.117 116.633C608.808 116.493 609.499 116.352 610.211 116.208C622.729 113.669 635.244 111.114 647.758 108.555C648.705 108.361 649.653 108.167 650.629 107.968C655.514 106.969 660.398 105.969 665.283 104.97C698.473 98.1818 731.67 91.4267 764.876 84.7195C790.506 79.5423 816.125 74.3164 841.735 69.0394C866.833 63.868 891.944 58.7609 917.062 53.6874C947.222 47.5954 977.371 41.4588 1007.51 35.2839C1012.99 34.1629 1018.46 33.0422 1023.93 31.9218C1025.32 31.6365 1025.32 31.6365 1026.74 31.3454C1043.83 27.848 1060.92 24.3672 1078.01 20.8905C1079.29 20.6303 1080.57 20.37 1081.88 20.1019C1094.59 17.5178 1107.29 14.9346 1119.99 12.3532C1124.72 11.3925 1129.44 10.4313 1134.17 9.47002C1136.36 9.02461 1138.55 8.57943 1140.74 8.13452C1142.8 7.71715 1144.85 7.29947 1146.91 6.88146C1148.85 6.48603 1150.8 6.0913 1152.74 5.69732C1157.31 4.76773 1161.88 3.81548 1166.43 2.81405C1167.72 2.53253 1167.72 2.53253 1169.04 2.24533C1170.64 1.89593 1172.23 1.54071 1173.83 1.17814C1174.54 1.02251 1175.25 0.866881 1175.99 0.706538C1176.9 0.500892 1176.9 0.500892 1177.83 0.291092C1180.89 -0.119827 1183.92 -0.0167604 1187 -9.6757e-05ZM1045 270C1043.35 270.33 1041.7 270.66 1040 271C1040 271.33 1040 271.66 1040 272C1041.98 272 1043.96 272 1046 272C1045.67 271.34 1045.34 270.68 1045 270ZM1045 273C1045 439.98 1045 606.96 1045 779C1045.33 779 1045.66 779 1046 779C1046 612.02 1046 445.04 1046 273C1045.67 273 1045.34 273 1045 273ZM1039 779C1039 779.33 1039 779.66 1039 780C1040.65 780 1042.3 780 1044 780C1044 779.67 1044 779.34 1044 779C1042.35 779 1040.7 779 1039 779ZM738 925C739 927 739 927 739 927L738 925ZM737 927C738 929 738 929 738 929L737 927ZM732 942C733 946 733 946 733 946L732 942ZM731 947C732 950 732 950 732 950L731 947ZM1184 954C1184 955.65 1184 957.3 1184 959C1184.33 959 1184.66 959 1185 959C1185 957.35 1185 955.7 1185 954C1184.67 954 1184.34 954 1184 954ZM1183 960C1184 963 1184 963 1184 963L1183 960ZM1182 965C1183 967 1183 967 1183 967L1182 965ZM1177 980C1178 982 1178 982 1178 982L1177 980ZM1172 992C1173 994 1173 994 1173 994L1172 992ZM1170 996C1171 998 1171 998 1171 998L1170 996ZM737 1029C738 1031 738 1031 738 1031L737 1029ZM739 1033C740 1035 740 1035 740 1035L739 1033ZM19 1058C20 1060 20 1060 20 1060L19 1058ZM12 1074C13 1076 13 1076 13 1076L12 1074ZM11 1077C12 1079 12 1079 12 1079L11 1077ZM458 1106C459 1109 459 1109 459 1109L458 1106ZM2 1118C2 1123.94 2 1129.88 2 1136C2.33 1136 2.66 1136 3 1136C3 1130.06 3 1124.12 3 1118C2.67 1118 2.34 1118 2 1118ZM454 1121C455 1123 455 1123 455 1123L454 1121ZM448 1136C449 1138 449 1138 449 1138L448 1136ZM7 1161C8 1164 8 1164 8 1164L7 1161ZM9 1168C10 1170 10 1170 10 1170L9 1168Z"
};

interface NoteProps {
    x: number;
    y: number;
    label: string;
    iconType: "blanche" | "clef" |"double";
    isOnStaff: boolean;
    onClick?: () => void;
}

/**
 * Composant "note" permettant d'afficher un bouton avec un texte et une note
 * 
 */
export const Note = ({ x, y, label, iconType, isOnStaff = false, onClick }: NoteProps) => {
    const [isActive, setIsActive] = useState(false);

    // référence vers la balise G pour permettre, par la suite, le redimensionnement la viewport de la balise "svg"
    let refG = useRef<SVGGElement>(null);
    // référence vers la balise SVG
    let refSVG = useRef<SVGSVGElement>(null);

    const handleClick = () => {
        setIsActive((prev) => !prev);
        onClick?.();
    };

    /**
     * Permet de déclencher le redimensionnement de la viewbox pour que le SVG s'adapte
     */
    useEffect(() => {
        // On récupère le Bouding box de la balise 'g'
        let bBox = refG.current?.getBBox();

        // mise à jour de la taille de la viewbox svg
        refSVG.current?.setAttribute('viewBox', `${bBox?.x} ${bBox?.y} ${bBox?.width} ${bBox?.height}`);

    }, []);

    // TRIGGER WARNING : (Ludo) je suis conscient que c'est pas la plus élégante des solutions
    // Attention : la balise "svg" doit être à l'extérieur pour convenir au composant "PartitionNote"
    // Dans le cas de notes seules (seulement les boutons) nous n'avons pas besoin de cette balise.
    // Merci de votre compréhension.
    if (!isOnStaff) {
        return (<svg ref={refSVG} xmlns="http://www.w3.org/2000/svg" style={{ maxWidth: "200px" }}>
            <g transform={`translate(${x}, ${y})`} ref={refG} onPointerDown={handleClick} style={{ cursor: "pointer" }}>
                <path d={icons[iconType]} fill={isActive ? "gray" : "black"} />
                <text x={20} y={25}>{label}</text>
            </g>
        </svg>);
    } else {
        return (<g transform={`translate(${x}, ${y})`} ref={refG} onPointerDown={handleClick} style={{ cursor: "pointer" }}>
            <path d={icons[iconType]} fill={isActive ? "gray" : "black"} />
            <text x={20} y={25}>{label}</text>
        </g>);
    }


};
